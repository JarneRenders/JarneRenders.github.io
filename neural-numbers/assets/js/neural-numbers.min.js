!function r(s,o,u){function l(e,t){if(!o[e]){if(!s[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(h)return h(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[e]={exports:{}};s[e][0].call(i.exports,function(t){return l(s[e][1][t]||t)},i,i.exports,r,s,o,u)}return o[e].exports}for(var h="function"==typeof require&&require,t=0;t<u.length;t++)l(u[t]);return l}({1:[function(t,e,a){"use strict";function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var i=function(){function i(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),this.el=t,this.cleanup(),this.bars=[];for(var e=0;e<10;e+=1){var a=document.createElement("div");a.className="barcontainer",this.bars[e]=document.createElement("div"),this.bars[e].classList.add("bar");var n=document.createElement("div");n.className="bartxt",n.innerHTML="".concat(e),a.appendChild(this.bars[e]),a.appendChild(n),this.el.appendChild(a)}}var t,e,a;return t=i,(e=[{key:"cleanup",value:function(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild)}},{key:"update",value:function(t,e){for(var a=1<arguments.length&&void 0!==e?e:-1,n=0;n<10;n+=1)this.bars[n].dataset.probability=t[n],this.bars[n].style="--probability: ".concat(t[n]),this.bars[n].classList.toggle("highlighted",n===a)}}])&&n(t.prototype,e),a&&n(t,a),i}();a.default=i},{}],2:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n,s=(n=t("./BarChart.js"))&&n.__esModule?n:{default:n};function i(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!e||a.length!==e);n=!0);}catch(t){i=!0,r=t}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return a}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return r(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return r(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function o(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=9,l=2*u,h=function(){function r(t,e,a){var n=3<arguments.length&&void 0!==arguments[3]&&arguments[3],i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2.2;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),this.clearTimeoutTime=i,this.drawingChanged=!0,this.model=e,this.nwvis=n,this.outputThreshold=a,this.pos={x:0,y:0},this.createUI(t),this.empty=!0,this.isdown=!1,this.pointerId=-1}var t,e,a;return t=r,(e=[{key:"addEventListeners",value:function(){var e=this;for(var t in this.eventfunctions={pointerdown:function(t){e.isdown||(e.removeClearTimeout(),e.setPosition(t),e.isdown=!0,e.pointerId=t.pointerId)},pointermove:function(t){e.isdown&&e.pointerId===t.pointerId&&e.draw(t)},pointerup:function(t){e.pointerId===t.pointerId&&(e.setClearTimeout(),e.isdown=!1)},pointerleave:function(t){e.pointerId===t.pointerId&&(e.setClearTimeout(),e.isdown=!1)},pointercancel:function(t){e.pointerId===t.pointerId&&(e.setClearTimeout(),e.isdown=!1)}},this.eventfunctions)this.drawcanvas.addEventListener(t,this.eventfunctions[t],{passive:!0})}},{key:"removeEventListeners",value:function(){for(var t in this.eventfunctions)this.drawcanvas.removeEventListener(t,this.eventfunctions[t])}},{key:"createUI",value:function(t){var e=this;this.drawcanvas=t.querySelector(".drawcanvas"),this.normalizecanvas=t.querySelector(".normalizecanvas")||document.createElement("canvas"),this.outputbars=t.querySelector(".bars"),this.outputdigit=t.querySelector(".digit"),this.inputbox=t.querySelector(".input.box"),this.addEventListeners();var a=this.normalizecanvas,n=this.drawcanvas;a.width=28,a.height=28;function i(){u=Math.floor(e.drawcanvas.clientWidth/28)-1,l=2*u,n.width=e.drawcanvas.clientWidth,n.height=e.drawcanvas.clientWidth}i(),window.onresize=function(){i()},this.drawcontext=this.drawcanvas.getContext("2d"),this.normalizecontext=this.normalizecanvas.getContext("2d"),this.outputbars&&(this.barchart=new s.default(this.outputbars)),this.clear()}},{key:"setPosition",value:function(t){var e=this.drawcanvas.getBoundingClientRect();return this.pos.x=t.clientX-e.left,this.pos.y=t.clientY-e.top,!0}},{key:"removeClearTimeout",value:function(){return this.clearTimeout&&clearTimeout(this.clearTimeout),!0}},{key:"setClearTimeout",value:function(){var t=this;return this.removeClearTimeout(),this.clearTimeout=setTimeout(function(){t.clear()},1e3*this.clearTimeoutTime),!0}},{key:"draw",value:function(t){this.removeClearTimeout();var e=this.pos.x,a=this.pos.y;this.setPosition(t);var n=this.pos.x,i=this.pos.y;if(Math.abs(n-e)+Math.abs(i-a)<3)return this.pos.x=e,void(this.pos.y=a);this.inputbox.classList.remove("background"),this.empty=!1,this.drawcontext.beginPath(),this.drawcontext.lineWidth=l,this.drawcontext.lineCap="round",this.drawcontext.strokeStyle="white",this.drawcontext.moveTo(e,a),this.setPosition(t),this.drawcontext.lineTo(n,i),this.drawcontext.stroke(),this.normalizecontext.fillStyle="black",this.normalizecontext.fillRect(0,0,this.normalizecanvas.width,this.normalizecanvas.height),this.drawingChanged=!0,this.normalize(l),this.predict()}},{key:"normalize",value:function(t){for(var e,a=0,n=0,i=1e3,r=-1e3,s=1e3,o=-1e3,u=this.drawcontext.getImageData(0,0,this.drawcanvas.width,this.drawcanvas.height).data,l=0,h=0;h<u.length;h+=4*t){var c=h/4%this.drawcanvas.width,d=h/4/this.drawcanvas.width|0;l+=u[h],a+=u[h]*c,n+=u[h]*d,0<u[h]&&(i=Math.min(i,d),r=Math.max(r,d),s=Math.min(s,c),o=Math.max(o,c))}return 0<l?(a/=l,n/=l,e=Math.max(o-s,r-i),this.normalizecontext.drawImage(this.drawcanvas,s,i,e,e,14+20/e*(s-a),14+20/e*(i-n),20,20)):this.normalizecontext.fillRect(0,0,this.normalizecanvas.width,this.normalizecanvas.height),!0}},{key:"predict",value:function(){var t,e,a,n=this;return this.model&&this.normalizecanvas&&this.drawingChanged&&(e=(t=i(tf.tidy(function(){var t=tf.browser.fromPixels(n.normalizecanvas,1).toFloat().mul(tf.scalar(1/255)).clipByValue(0,1).reshape([1,28,28,1]);n.nwvis&&n.nwvis.show(t,n.normalizecontext.getImageData(0,0,n.normalizecanvas.width,n.normalizecanvas.height).data.filter(function(t,e){return e%4==0}));var e=n.model.predict(t);return[e.dataSync(),e.argMax([-1]).dataSync()]}),2))[0],a=t[1],this.barchart&&this.barchart.update(e,a),this.outputdigit&&(this.outputdigit.innerHTML=!this.empty&&e[a]>this.outputThreshold?a:"?",this.outputdigit.parentElement.classList.toggle("solved",e[a]>this.outputThreshold))),!0}},{key:"clear",value:function(){this.drawcontext.fillRect(0,0,this.drawcanvas.width,this.drawcanvas.height),this.empty=!0,this.normalize(100),this.predict(),this.inputbox.classList.add("background")}},{key:"cleanup",value:function(){this.clear(),this.removeEventListeners(),this.barchart&&this.barchart.cleanup()}}])&&o(t.prototype,e),a&&o(t,a),r}();a.default=h},{"./BarChart.js":1}],3:[function(t,e,a){"use strict";var n,i=(n=t("./neural-numbers-component"))&&n.__esModule?n:{default:n};function r(t,e){return void 0===t?e:"false"!==t}$("[data-component=neural-numbers]").each(function(t,e){var a={modelPath:$(e).attr("data-model")||null,inputPlaceholder:$(e).attr("data-input-placeholder")||"",showBars:r($(e).attr("data-show-bars"),!1),showNormalizer:r($(e).attr("data-show-normalizer"),!1),showTraining:r($(e).attr("data-show-training"),!1),showOutput:r($(e).attr("data-show-output"),!0)};new i.default(e,a).init()})},{"./neural-numbers-component":4}],4:[function(t,e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=void 0;var n,i=(n=t("./Paint"))&&n.__esModule?n:{default:n};function r(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,a,n,i,r,s){try{var o=t[r](s),u=o.value}catch(t){return void a(t)}o.done?e(u):Promise.resolve(u).then(n,i)}function s(o){return function(){var t=this,s=arguments;return new Promise(function(e,a){var n=o.apply(t,s);function i(t){u(n,e,a,i,r,"next",t)}function r(t){u(n,e,a,i,r,"throw",t)}i(void 0)})}}var o={};function l(){return(l=s(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||e in o){t.next=4;break}return t.next=3,tf.loadLayersModel(e);case 3:o[e]=t.sent;case 4:return t.abrupt("return",o[e]);case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}var h=function(){function u(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),this.$element=$(t),this.props=e,this.model=null,this.paint=null;var a=this.props,n=a.inputPlaceholder,i=a.showBars,r=a.showNormalizer,s=a.showTraining,o=a.showOutput;this.$element.addClass("neural-numbers-component"),this.$element.toggleClass("with-bars",i),this.$element.toggleClass("with-normalizer",r),this.$element.toggleClass("with-training",s),this.$element.toggleClass("with-output",o),this.$inputStage=$("<div>").addClass(["stage","stage-input","input","box"]).appendTo(this.$element),this.$drawCanvas=$("<canvas>").addClass(["drawcanvas","input-canvas"]).appendTo($("<div>").addClass("input-canvas-wrapper").appendTo(this.$inputStage)),n&&$("<div>").addClass("input-placeholder").append($("<span>").html(n)).appendTo(this.$inputStage),this.$normalizeStage=$("<div>").addClass(["stage","stage-normalize"]).appendTo(this.$element),this.$normalizeCanvas=$("<canvas>").addClass("normalizecanvas").appendTo($("<div>").addClass("normalize-canvas-wrapper").appendTo(this.$normalizeStage)),this.$probabilityStage=$("<div>").addClass(["stage","stage-bars"]).appendTo(this.$element),this.$bars=$("<div>").addClass("bars").appendTo(this.$probabilityStage),this.$outputStage=$("<div>").addClass(["stage","stage-output"]).appendTo(this.$element),this.$output=$("<div>").addClass(["output","digit"]).appendTo($("<div>").addClass("output-wrapper").appendTo(this.$outputStage))}var t,e,a,n;return t=u,(e=[{key:"init",value:(n=s(regeneratorRuntime.mark(function t(){var e;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.props.modelPath,t.next=3,function(t){return l.apply(this,arguments)}(e);case 3:this.model=t.sent,this.paint=new i.default(this.$element[0],this.model,.5,!1,u.PAINT_CLEAR_TIMEOUT);case 5:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})}])&&r(t.prototype,e),a&&r(t,a),u}();(a.default=h).PAINT_CLEAR_TIMEOUT=2.2},{"./Paint":2}]},{},[3]);
//# sourceMappingURL=neural-numbers.min.js.map
